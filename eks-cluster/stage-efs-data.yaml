---
apiVersion: v1
kind: ConfigMap
metadata:
  name: stage-data 
data:
  stage-data.sh: |
    aws s3 cp --recursive s3://$S3_BUCKET/$S3_PREFIX /efs
---
apiVersion: v1
kind: Pod
metadata:
  name: stage-efs 
spec:
  restartPolicy: Never
  volumes:
  - name: efs
    persistentVolumeClaim:
      claimName: # name space persistent volume claim 
  - name: config
    configMap:
      defaultMode: 420
      items:
      - key: stage-data.sh
        mode: 365
        path: stage-data.sh
      name: stage-data 
  containers:
  - name: data
    env:
    - name: S3_BUCKET
      value: my-bucket 
    - name: S3_PREFIX
      value: my-bucket-prefix 
    command:
    -  sh 
    - /etc/config/stage-data.sh
    image: # use image with aws cli support  
    imagePullPolicy: IfNotPresent
    volumeMounts:
    - mountPath: /etc/config
      name: config
    - mountPath: /efs
      name: efs
